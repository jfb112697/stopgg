import{s as w,o as l,n as t}from"../chunks/scheduler.6af7431e.js";import{S as b,i as _,d as p,v as y}from"../chunks/index.35075c1a.js";import{u as d}from"../chunks/user.d225e991.js";const S=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{console:v}=S;function a(s){const e={c:t,l:t,m:t,p:t,i:t,o:t,d:t};return p("SvelteRegisterBlock",{block:e,id:a.name,type:"component",source:"",ctx:s}),e}function I(s,e,P){let{$$slots:u={},$$scope:$}=e;y("Page",u,[]),l(async()=>{const n=new URLSearchParams(window.location.search).get("code");if(!n){console.error("No code provided. OAuth failed.");return}const r=await await fetch("https://api.start.gg/oauth/access_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"authorization_code",client_id:"48",client_secret:"0c3c9eb4048969116b8bea5d716bbf6831b31fb5f4a2a390d6c0f9ca2fc6e365",code:n,redirect_uri:"https://stopgg.web.app/oauth-callback",scopes:"user.identity user.email tournament.manage"})});console.dir(r);const g=await r.json(),{access_token:c,refresh_token:m}=g,h=`
      query {
        currentUser {
          name
        }
      }
    `,i=(await(await fetch("https://api.start.gg/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({query:h})})).json()).data.currentUser;d.set(i),localStorage.setItem("user",JSON.stringify(i)),localStorage.setItem("access_token",c),localStorage.setItem("refresh_token",m),window.location.href="/"});const f=[];return Object.keys(e).forEach(o=>{!~f.indexOf(o)&&o.slice(0,2)!=="$$"&&o!=="slot"&&v.warn(`<Page> was created with unknown prop '${o}'`)}),s.$capture_state=()=>({onMount:l,user:d}),[]}class C extends b{constructor(e){super(e),_(this,e,I,a,w,{}),p("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:a.name})}}export{C as component};
